<% provide(:title, "Our Government | Our Experiences") %>
<span class="logo"><%= link_to (image_tag "OurGov_Logo3.png", height: 'auto', width: '100%'), "http://ourgov.io" %></span>
<!--
<div class="searchbar">
	<script>
	  (function() {
	    var cx = '005827720271794702134:ft3mpiyihqa';
	    var gcse = document.createElement('script');
	    gcse.type = 'text/javascript';
	    gcse.async = true;
	    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
	        '//cse.google.com/cse.js?cx=' + cx;
	    var s = document.getElementsByTagName('script')[0];
	    s.parentNode.insertBefore(gcse, s);
	  })();
	</script>
	<gcse:search></gcse:search>
</div>
-->

<script src="//cdn.jsdelivr.net/jquery/2.1.3/jquery.min.js"></script>
<script src="//cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>

<div class="search-box">
  <div class="search">
  	<input type="text">
    <script>
    $(document).ready(function() {
      var $input = $('input');
      $input.keyup(function() {
    	  console.log("keyup event");
        index.search($input.val(), {
          hitsPerPage: 10,
          facets: '*'
        }, searchCallback);
      });
    });

    function searchCallback(err, content) {
      if (err) {
        console.error(err);
        return;
      }

      var $users = $('#users');
      $users.empty();

      for (var i = 0; i < content.hits.length; i++) {
        $users.append('<li>' + content.hits[i].name + '</li>');
      }
    };
    </script>
  </div>
  <div class="results">
  	<ul id="users"></ul>
  </div>
</div>

<script type="text/javascript">
$(document).ready(function(){
	$.each(['categories', 'nyc_executives', 'city_agencies', 'subways', 'post_offices', 'state_agencies', 'state_parks', 'dmv'], function(index, cssName){
		var list = $('.'+cssName+'_list');
		$(list).hide();
		$('.'+cssName).click(function(){
			$(list).slideToggle('slow');
		});
	});
});
</script>


<style type="text/css">
  html { height: 100% }
  body { height: 100%; margin: 0; padding: 0 }
  #map-canvas { height: 100% }
</style>

<script type="text/javascript">
  function test() {
    console.log('test() called');
  }

	function initialize() {
		//var marker = new google.maps.Marker({
	  //    position: new google.maps.LatLng(40.716593, -74.010593),
	  //    map: map,
	  //    title: 'My old house!'
    //});
    var map;

    $.get('public_entities/user_location', test);

    $.get('public_entities/user_location', function(data) {
      var userLatLng = data;
      console.log(userLatLng);

      // setup the map options (center it according to the user lat lng)x
	    var mapOptions = {
        //center: { lat: 40.725968, lng: -73.997667},
        center: { lat: userLatLng[0], lng: userLatLng[1]},
        zoom: 12
	    };

      // create the map
	    map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
	
      // add a marker for our current location
      var marker = new google.maps.Marker({
        position: new google.maps.LatLng(userLatLng[0], userLatLng[1]),
        map: map,
        title: 'User!'
      });
    });

    //$.ajax(
    //  url: userLocUrl,
    //  success: function(res){
    //    console.log(res);
    //  },
    //  complete: function(){
    //    console.log("complete");
    //  }
    //);
		//var userLatLng = $.getJSON(userLocUrl, { format: 'json' })
	  }
	  google.maps.event.addDomListener(window, 'load', initialize);
</script>

<!--
<div>
	<h3>Most Recent Posts</h3>
	<ol>
		<% @ten_most_recent_posts.each do |post| %>
				<li>
				<% if post.review != nil %>
				At <%= post.updated_at.time.strftime("%m/%d/%y %l:%M %p") %>
				<%= post.user.first_name.to_s + ' ' + post.user.last_name[0].to_s + ". "%> reviewed
				<strong><%= link_to post.public_entity.name, post.public_entity,  'data-no-turbolink' => true%></strong>:
				<%= link_to post.review[0..50], post.public_entity, 'data-no-turbolink' => true %>...
				<% end %>
			</li>
		<% end %>
	</ol>
</div>
-->

<!--
<div id="map-canvas" style="width: 100%; height: 400px; display:inline-block"></div>
-->

<body>
  <div class="home-page-description">OurGov is a digital platform to leave feedback and report problems to government services and agencies.</div>

<table class="nav_buttons">
	<tr class="row">
		<td>DMVs
		</td>
		<td>Post Offices
		</td>
		<td>Parks & Rec
		</td>
		<td>Police & Fire Services
		</td>
	</tr>
	<tr class="row">
		<td>City & State Agencies
		</td>
		<td>Subways & MTA
		</td>
		<td>Public Officials
		</td>
		<td>Schools
		</td>
	</tr>
</table>

<h3 class="categories">Browse by Category</h3>
<ul>
	<% @categories.each do |category| %>
		<li class="categories_list"><%= link_to category.name, category_path(category) %></li>
	<% end %>
</ul>

<h3 class="nyc_executives">NYC Executive Officers</h3>
<ul><% @nyc_executives.each do |entity| %>
	<div class="nyc_executives_list"><%=link_to entity.name, public_entity_url(entity), 'data-no-turbolink' => true %></div>
	<%end%>
</ul>

<h3 class="city_agencies">NYC Agencies</h3>
<ul><% @nyc_agencies.each do |entity| %>
	<div class="city_agencies_list"><%=link_to entity.name, public_entity_url(entity), 'data-no-turbolink' => true %></div>
	<%end%>
</ul>

<h3 class="subways">NYC Subway Stations</h3>
<ul><% @nyc_subway_stations.each do |entity| %>
	<div class="subways_list"><%=link_to entity.name, public_entity_url(entity), 'data-no-turbolink' => true %></div>
	<%end%>
</ul>

<h3 class="post_offices">NYC Post Offices</h3>
<ul><% @nyc_post_offices.each do |entity| %>
	<div class="post_offices_list"><%=link_to entity.name, public_entity_url(entity), 'data-no-turbolink' => true %></div>
	<%end%>
</ul>

<h3 class="state_agencies">NY State Agencies</h3>
<ul><% @nystate_agencies.each do |entity| %>
	<div class="state_agencies_list"><%=link_to entity.name, public_entity_url(entity), 'data-no-turbolink' => true %></div>
	<%end%>
</ul>

<h3 class="state_parks">NY State Parks</h3>
<ul><% @nystate_parks.each do |entity| %>
	<div class="state_parks_list"><%=link_to entity.name, public_entity_url(entity), 'data-no-turbolink' => true %></div>
	<%end%>
</ul>

<h3 class="dmv">DMVs</h3>
<ul><% @dmvs.each do |entity| %>
	<div class="dmv_list"><%=link_to entity.name, public_entity_url(entity), 'data-no-turbolink' => true %></div>
	<%end%>
</ul>
</body>